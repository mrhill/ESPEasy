<head><title>Shade Setup</title></head>
<style>
body {
	margin: 0;
	font-family: "Helvetica Neue", Arial, sans-serif;
	text-align: center;
	font-size: 6vw;
}

h1 {
	font-size: 8vw;
	margin: 2vw;
}

table {
	font-size: 5vw;
	margin-left:auto;
	margin-right:auto;
}
th { padding-top: 2vw; }
p { margin: 2vw 0; }

button {
	display: inline-block;
	margin: .5vw;
	border: 0;
	border-radius: .5vw;
	padding: 1vw 2vw;
	cursor: pointer;
	font-size: 6vw;
	background-color: #ccc;
	color: #000;
	line-height: 1.5;
}
button:hover {
	opacity: 0.85;
}
.med {
	text-align: left;
	width: 25rem;
	padding: 1rem 3rem;
	background-color: #2af;
	color: #fff;
	font-weight: 500;
	font-size: 4rem;
}
.act {
	background-color: #2af;
	color: #fff;
}

input {font-size: 4vw;}
input[type=text] { width: 25rem; }
input[type=number] { width: 7rem; }
input[type=checkbox] {
	height: 5vw;
	width: 5vw;
	margin: 2vw 2vw;
}

#pop {
	display: none;
	position: absolute;
	width: 100%;
	padding: 1vw;
	opacity: .9;
}
</style>

<script>
function popup(txt,inf) {
	let e = document.getElementById('pop');
	e.firstChild.innerText = txt;
	e.style.color = inf&&'#040'||'red';
	e.style.background = inf&&'#CFC'||'pink';
	e.style.display = 'block';
}
function load() {
	fetch("/json").then(r=>r.json()).then(dev=>{
		document.querySelector('input#name').value = dev['System']['Unit Name'];
		document.querySelector('input#unit').value = dev['System']['Unit Number'];
		document.querySelector('input#inv1').checked = dev['Sensors'][5]['TaskValues'][0]['Value'];
		document.querySelector('input#inv2').checked = dev['Sensors'][5]['TaskValues'][1]['Value'];
		document.querySelector('input#ip').value = dev['WiFi']['IP Address'];
	}).catch(()=>{
		popup("Error loading from device");
	});
}
function inv(n) {
	let cb = document.querySelector('input#inv'+n)
	return '/tools?cmd=TaskValueSet,6,'+cb.id.slice(-1)+','+(+cb.checked);
}
function save() {
	let u = document.querySelector('input#unit').value;
	if (u<1||u>254) {
		popup("Set Unit Number between 1 and 254");
	} else {
		var urls = [
			'/tools?cmd=unit,'+u,
			'/tools?cmd=name,'+document.querySelector('input#name').value.trim(),
			inv(1),
			inv(2)
		];
		Promise.all(urls.map(url => fetch(url).then(resp =>{
				if (!resp.ok) { throw 404; }
				return resp.text();
			}))).then(texts => {
				fetch('/tools?cmd=save');
				popup("Saved to Device",1);
		}).catch(()=>{
			popup("Error saving to device");
		});
	}
}
document.addEventListener("DOMContentLoaded", load);
</script>

<body>
	<div id="pop"><span></span><button onclick="document.getElementById('pop').style.display='none'">&#x274E;</button></div>

	<h1>Shade Setup</h1>

	<table>
		<tr><td>IP:</td><td><input readonly type="text" id="ip"></td></tr>
		<tr><td>Unit Name:</td><td><input type="text" id="name" maxlength="25"></td></tr>
		<tr><td>Unit Number:</td><td><input type="number" id="unit" min="1" max="254" value="0"></td></tr>

		<tr><th>Motor 1</th><th>Motor 2</th></tr>
		<tr><td><button onclick="fetch('/tools?cmd=event+up0')" class="med">&#9650; Up</button></td>
			<td><button onclick="fetch('/tools?cmd=event+up1')" class="med">&#9650; Up</button ></td></tr>
		<tr><td><button onclick="fetch('/tools?cmd=event+stop0')" class="med">&#9632; Stop</button></td>
			<td><button onclick="fetch('/tools?cmd=event+stop1')" class="med">&#9632; Stop</button></td></tr>
		<tr><td><button onclick="fetch('/tools?cmd=event+down0')" class="med">&#9660; Down</button></td>
			<td><button onclick="fetch('/tools?cmd=event+down1')" class="med">&#9660; Down</button></td></tr>
		<tr><td><input id="inv1" type="checkbox" onclick="fetch(inv(1))"/><label for="inv1">Invert &#8645;</label></td>
			<td><input id="inv2" type="checkbox" onclick="fetch(inv(2))"/><label for="inv2">Invert &#8645;</label></td></tr>
	</table>

	<p><button class="act" onclick="save()">Save Settings</button></p>

	<div>
		<button onclick="location.href='groups.htm'">Edit Groups</button>
		<button onclick="location.href='/'">Home</button>
		<button onclick="location.href='/config'">&#9881;Expert</button>
	</div>
</body>
